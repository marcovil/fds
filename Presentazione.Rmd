---
title: "Presentazione"
author: "Marco Villotta"
date: "2023-06-23"
output:
  ioslides_presentation:
    widescreen: true
    smaller: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, warning=FALSE, message=FALSE}
library(tidyr)
library(dplyr)
library(jsonlite)
library(purrr)
library(stringr)
library(lubridate)
library(modelr)
library(broom)
library(tibble)
library(ggplot2)
library(mgcv)
library(ineq)

performances <- readRDS("perf.RDS")
pcp <- readRDS("pcp.RDS")
pcp_models_simp <- readRDS("pcp_models_simp.RDS")
pcp_glance <- readRDS("pcp_glance.RDS")
pcp_resids <- readRDS("pcp_resids.RDS")
before_1909 <- readRDS("before_1909")
```

## Dataset usato {.flexbox .vcenter}

New York Philharmonic, pubblicato su https://github.com/nyphilarchive/PerformanceHistory e disponibile in XML o JSON (che ho usato).

Orchestra americana, ancora attiva, fondata nel 1842.

Il dataset contiene sostanzialmente il programma dell'attività dell'orchestra, organizzato in questo modo:

```{js echo = TRUE}
  "programs": [
    {
      "id": "38e072a7-8fc9-4f9a-8eac-3957905c0002", // GUID
      "programID": "3853", // NYP Local ID
      "orchestra": "New York Philharmonic",
      "season": "1842-43",
          "concerts": [ { ... }, /* A program can have multiple concerts */ ],
      "works": [ {
          "composerName": "Weber,  Carl  Maria Von",
          "workTitle": "OBERON",
          "conductorName": "Timm, Henry C.",
        "soloists": [ ... ] }, /* a program will usually have multiple works */ { ... }, ] },
    /* more programs */
  ]
```

## Compositori nel tempo {.flexbox .vcenter}

Come evolve negli anni (nel lungo periodo) il repertorio dell'orchestra? Ci sono compositori per cui cresce o diminuisce il numero di rappresentazioni?

```{r}
ggplot(pcp,aes(seasonYear, perc, color = composerName)) +
  geom_line(alpha = 1/4, show.legend = FALSE) +
  labs(
    x = "stagione",
    y = "performance compositore / performance stagione (%)",
  ) +
  theme_light()
```

## Compositori nel tempo {.flexbox .vcenter}
Componenti quadratiche positive (Dvorak, Strauss) e negative (Ravel, Prokofiev).

```{r, message=FALSE}
pcp %>%
  filter(composerName == "Dvorak, Antonín" | composerName == "Ravel, Maurice" |
           composerName == "Strauss, Richard" | composerName == "Prokofiev, Sergei") %>%
ggplot(aes(seasonYear, perc)) +
  geom_line(show.legend = FALSE) +
  geom_point(show.legend = FALSE) +
  geom_smooth() +
  labs(
    x = "stagione",
    y = "performance compositore / performance stagione (%)",
  ) +
  facet_wrap(~composerName) +
  theme_light()
```

## Compositori nel tempo {.flexbox .vcenter}
Alcuni modelli che hanno un buon fit.

```{r, message=FALSE}
pcp %>%
  filter(composerName == "Chopin, Frédéric" | composerName == "Bruch, Max" |
           composerName == "Weber, Carl Maria Von" | composerName == "Gluck, Christoph Willibald") %>%
ggplot(aes(seasonYear, perc)) +
  geom_line(show.legend = FALSE) +
  geom_point(show.legend = FALSE) +
  geom_smooth() +
  labs(
    x = "stagione",
    y = "performance compositore / performance stagione (%)",
  ) +
  facet_wrap(~composerName) +
  theme_light()
```

## Compositori nel tempo {.flexbox .vcenter}
Compositori rappresentati con una certa continuità prima della stagione 1909-1910.

```{r, message=FALSE}
ggplot(
  pcp %>%
  inner_join(before_1909)
) +
  geom_point(aes(x = seasonYear, y = perc),alpha = 1/4) +
  geom_vline(aes(xintercept = 1909, color = "red"), show.legend = FALSE) +
  facet_wrap(~composerName) +
  labs(
    x = NULL,
    y = NULL,
  ) +
  scale_x_continuous(labels = NULL) +
  theme_light()
```

## Compositori nel tempo {.flexbox .vcenter}
Le stagioni prima del 1909 sono molto più "eque" nella divisione delle performance fra diversi compositori

```{r}
pcp %>%
  select(seasonYear,n) %>%
  group_by(seasonYear) %>%
  mutate(gini = Gini(n)) %>%
  distinct(seasonYear,gini) %>%
ggplot() +
    geom_vline(aes(xintercept = 1909, color = "red"), show.legend = FALSE) +
    geom_line(aes(seasonYear,gini)) +
  labs(
    x = "stagione",
    y = "indice Gini",
  ) +
  theme_light()
```

## Compositori nel tempo {.flexbox .vcenter}
Questo nonostante aumenti il numero di compositori.

```{r}
performances %>%
  group_by(seasonYear) %>%
  mutate(composers = n_distinct(composerName)) %>%
  ungroup() %>%
ggplot() +
    geom_vline(aes(xintercept = 1909, color = "red"), show.legend = FALSE) +
    geom_line(aes(seasonYear,composers)) +
  labs(
    x = "stagione",
    y = "numero di compositori",
  ) +
  theme_light()
```

## Slide with R Output

```{r cars, echo = TRUE}
summary(cars)
```

## Slide with Plot

```{r pressure}
plot(pressure)
```

